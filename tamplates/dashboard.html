<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Панель управления CCTV</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo"><span>OCTO</span> CCTV System</div>
            <ul class="nav-menu">
                <li><a href="#dashboard" class="nav-link active" data-page="dashboard">Главная</a></li>
                <li><a href="#live" class="nav-link" data-page="live">Live</a></li>
                {% if role == 'Admin' %}
                <li><a href="#settings" class="nav-link" data-page="settings">Settings</a></li>
                <li><a href="#logs" class="nav-link" data-page="logs">Logs</a></li>
                <li><a href="#biometric" class="nav-link" data-page="biometric">Biometric</a></li>
                {% endif %}
                <li><a href="/logout" class="nav-link">Выход</a></li>
                <li>
                    <button id="themeToggle" class="theme-toggle" title="Сменить тему">
                        Ночь
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page active">
            <div class="dashboard-header">
                <h1>Главная панель</h1>
                <div class="system-controls">
                    <button id="startSystem" class="btn btn-success">Запустить систему</button>
                    <button id="stopSystem" class="btn btn-danger" disabled>Остановить систему</button>
                </div>
            </div>
            <div class="status-panel">
                <div class="status-card">
                    <h3>Статус системы</h3>
                    <p id="systemStatus" class="status-text">Остановлена</p>
                </div>
            </div>
            <div class="info-message">
                <p><strong>Важно:</strong> Перед запуском системы настройте режимы работы камер в разделе <strong>Settings</strong>. Настройки применяются автоматически при запуске.</p>
            </div>
        </div>

        <!-- Live Page -->
        <div id="live-page" class="page">
            <h1>Прямая трансляция</h1>
            <div class="camera-selector">
                <label>Выбрать камеру:</label>
                <select id="cameraSelect">
                    <option value="all">Все камеры</option>
                    {% for cam_id in camera_indices %}
                    <option value="{{ loop.index0 }}">Камера {{ loop.index0 }}</option>
                    {% endfor %}
                </select>
            </div>
            <div id="videoContainer" class="video-container">
                <div class="camera-grid" id="cameraGrid">
                    {% for cam_id in camera_indices %}
                    <div class="camera-item">
                        <img src="{{ url_for('video_feed', camera_id=cam_id) }}" alt="Camera {{ loop.index0 }}">
                        <div class="camera-label">Камера {{ loop.index0 }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Settings Page (Admin only) -->
        {% if role == 'Admin' %}
        <div id="settings-page" class="page">
            <h1>Настройки камер</h1>
            <div class="settings-container">
                {% for cam_id in camera_indices %}
                <div class="camera-settings-card">
                    <h2>Камера {{ loop.index0 }}</h2>
                    <div class="settings-controls">
                        <label>
                            <input type="checkbox" class="setting-checkbox" data-camera="{{ cam_id }}" data-setting="faces">
                            Face Detection
                        </label>
                        <label>
                            <input type="checkbox" class="setting-checkbox" data-camera="{{ cam_id }}" data-setting="motion">
                            Motion Detection
                        </label>
                        <label>
                            <input type="checkbox" class="setting-checkbox" data-camera="{{ cam_id }}" data-setting="recording" checked disabled>
                            Recording (всегда включено)
                        </label>
                        <label>
                            <input type="checkbox" class="setting-checkbox" data-camera="{{ cam_id }}" data-setting="triggered">
                            Triggered Mode
                        </label>
                        <div class="timeout-control">
                            <label>Timeout (секунды):</label>
                            <input type="number" class="timeout-input" data-camera="{{ cam_id }}" value="10" min="1" max="60">
                        </div>
                        <div class="sensitivity-control-inline">
                            <label>Чувствительность движения:</label>
                            <div class="slider-container">
                                <span class="slider-label-min">Высокая</span>
                                <input type="range" class="sensitivity-slider" data-camera="{{ cam_id }}" min="5" max="100" value="25">
                                <span class="slider-label-max">Низкая</span>
                            </div>
                            <div class="sensitivity-value-inline">
                                Значение: <span class="sensitivity-display" data-camera="{{ cam_id }}">25</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary apply-btn" data-camera="{{ cam_id }}">Apply Mode</button>
                </div>
                {% endfor %}
            </div>
            
            
            <!-- Маски создаются через терминальную версию (python launcher.py → 2) -->
            <div class="masks-section collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h2>Маски камер</h2>
                    <span class="collapse-icon">▼</span>
                </div>
                <div class="collapsible-content">
                    <p class="info-text">Для создания масок используйте терминальную версию программы.</p>
                    <div class="mask-view">
                        <h3>Существующие маски:</h3>
                        <div id="masksList"><em>Загрузка...</em></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Page (Admin only) -->
        <div id="logs-page" class="page">
            <h1>Логи системы</h1>
            <div class="logs-controls">
                <div class="filter-group">
                    <label>Фильтр по статусу:</label>
                    <select id="statusFilter">
                        <option value="">Все</option>
                        <option value="INFO">INFO</option>
                        <option value="SUCCESS">SUCCESS</option>
                        <option value="WARNING">WARNING</option>
                        <option value="ERROR">ERROR</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Фильтр по дате:</label>
                    <input type="date" id="dateFilter">
                </div>
                <button id="refreshLogs" class="btn btn-primary">Обновить</button>
            </div>
            <div class="logs-container">
                <pre id="logsContent"></pre>
            </div>
        </div>

        <!-- Biometric Page (Admin only) -->
        <div id="biometric-page" class="page">
            <h1>Биометрическая система</h1>
            <div class="biometric-controls">
                <div class="biometric-card">
                    <h2>Обучение модели</h2>
                    <p>Обучить модель распознавания лиц на основе данных в папке dataset</p>
                    <button id="trainModelBtn" class="btn btn-primary">Обучить модель</button>
                    <div id="trainStatus"></div>
                </div>
                <div class="biometric-card">
                    <h2>Загрузка фотографий</h2>
                    <p>Загрузить новые фотографии пользователей для обучения</p>
                    <div class="upload-form">
                        <input type="text" id="userName" placeholder="Имя пользователя (ФИО)" required>
                        <input type="file" id="photoUpload" accept="image/*" multiple>
                        <button id="uploadPhotosBtn" class="btn btn-primary">Загрузить фотографии</button>
                    </div>
                    <div id="uploadStatus"></div>
                </div>
            </div>
        </div>
        {% endif %}
    </main>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

